\documentclass{book}

\usepackage{caption}
\usepackage{hyperref}
\usepackage{listings}

\usepackage{ult-custom-listings}

\usepackage{xcolor}
\usepackage{float}
\usepackage{filecontents}

\begin{filecontents*}{samplecode.c}
#include <stdio.h>

int main(void)
{
  printf("Hello world!\n");
  return 0;
}
\end{filecontents*}

\lstset{captionpos=b,numbers=left,backgroundcolor=\color[rgb]{0.9,0.9,1}}

\makeatletter
\newcustomlstenvironment{codesnippet}{locodesnippet}{Code Snippet}[1][]
  {\lstset{#1,language=C,frame=tb,captionpos=t,backgroundcolor=\color[rgb]{1,1,0.9}}%
   \csname lst@SetFirstNumber\endcsname}
  {\csname lst@SaveFirstNumber\endcsname}

\newcustomlstenvironment{algorithm}{loalgorithm}{Algorithm}[1][]
  {\lstset{#1,language=C,frame=tblr,captionpos=t,backgroundcolor=\color[rgb]{0.9,1,0.9}}%
   \csname lst@SetFirstNumber\endcsname}
  {\csname lst@SaveFirstNumber\endcsname}
\makeatother

\captionsetup[codesnippet]{box=colorbox,boxcolor={yellow}}
\captionsetup[lstlisting]{box=colorbox,boxcolor={cyan},skip=-1pt}

\begin{document}
\listof{lstlisting}{List of Listings}
\listof{codesnippet}{List of Code Snippets}
\listof{algorithm}{List of Algorithms}

\chapter{Environments}

\begin{lstlisting}[caption={Test 1},label={listing:test1},name={test}]
Line 1
Line 2
\end{lstlisting}

\begin{lstlisting}[caption={Test 2},label={listing:test2},name={test}]
Line 3
Line 4
\end{lstlisting}

Referencing normal listings: \autoref{listing:test1}, \autoref{listing:test2}.

\begin{codesnippet}[caption={First snippet},label={snippet:first},name={hello}]
#include <stdio.h>
\end{codesnippet}

\begin{algorithm}[caption={First algorithm},label={alg:first},name={myalg}]
A
B
\end{algorithm}

\begin{codesnippet}[caption={Second snippet},label={snippet:second},name={hello}]
int main(void)
{
  printf("Hello world!\n");
  return 0;
}
\end{codesnippet}

Referencing snippets: \autoref{snippet:first}, \autoref{snippet:second}.

\begin{algorithm}[caption={Second algorithm},label={alg:second},name={myalg}]
C
\end{algorithm}

Referencing algorithms: \autoref{alg:first}, \autoref{alg:second}.

\chapter{Input}
\lstinputcodesnippet[caption={this is my caption},label={snippet:input}]{samplecode.c}

Referencing snippet: \autoref{snippet:input}.

\end{document}
